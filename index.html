<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Login Firebase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #3367d6;
        }
        
        .btn-logout {
            background: #ea4335;
        }
        
        .btn-logout:hover {
            background: #d33426;
        }
        
        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: left;
        }
        
        .hidden {
            display: none;
        }
        
        .game-area {
            margin-top: 20px;
            padding: 20px;
            background: #e9ecef;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® Test Login Game</h1>
        
        <!-- Login Screen -->
        <div id="loginScreen">
            <p>Login untuk mulai bermain!</p>
            <button class="btn" onclick="loginWithGoogle()">ğŸ” Login dengan Google</button>
        </div>
        
        <!-- Game Screen -->
        <div id="gameScreen" class="hidden">
            <div class="user-info">
                <h3>ğŸ‘‹ Hallo, <span id="userName"></span>!</h3>
                <p>Email: <span id="userEmail"></span></p>
            </div>
            
            <div class="game-area">
                <h3>ğŸ¯ Game Sederhana</h3>
                <p>Score: <span id="score">0</span></p>
                <button class="btn" onclick="addScore()">â• Tambah Score</button>
                <button class="btn" onclick="saveGame()">ğŸ’¾ Save Game</button>
            </div>
            
            <button class="btn btn-logout" onclick="logout()">ğŸšª Logout</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Config - PASTE CONFIG ANDA DISINI
        const firebaseConfig = {
            apiKey: "AIzaSyBx7jHd...",
            authDomain: "ratno-game-8d5e8.firebaseapp.com",
            projectId: "ratno-game-8d5e8",
            storageBucket: "ratno-game-8d5e8.appspot.com",
            messagingSenderId: "1068721255",
            appId: "1:1068721255:web:abcd1234..."
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        let currentScore = 0;
        let currentUser = null;

        // Cek apakah user sudah login
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                // User sudah login
                currentUser = user;
                showGameScreen(user);
            } else {
                // User belum login
                showLoginScreen();
            }
        });

        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithPopup(provider)
                .then((result) => {
                    console.log("Login sukses!", result.user);
                    alert("ğŸ‰ Login berhasil! Selamat datang " + result.user.displayName);
                }).catch((error) => {
                    console.error("Login error:", error);
                    alert("âŒ Login gagal: " + error.message);
                });
        }

        function logout() {
            firebase.auth().signOut()
                .then(() => {
                    alert("ğŸ‘‹ Logout berhasil!");
                    currentScore = 0;
                }).catch((error) => {
                    alert("Logout error: " + error.message);
                });
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
        }

        function showGameScreen(user) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            document.getElementById('userName').textContent = user.displayName;
            document.getElementById('userEmail').textContent = user.email;
            
            // Load saved game data
            loadGameData(user.uid);
        }

        function addScore() {
            currentScore += 10;
            document.getElementById('score').textContent = currentScore;
        }

        function saveGame() {
            if (!currentUser) return;
            
            const gameData = {
                score: currentScore,
                lastSaved: new Date()
            };
            
            // Save ke Firestore
            firebase.firestore().collection('users').doc(currentUser.uid).set({
                gameData: gameData
            }, { merge: true })
            .then(() => {
                alert("âœ… Game berhasil disimpan!");
            })
            .catch((error) => {
                alert("âŒ Gagal save: " + error.message);
            });
        }

        function loadGameData(userId) {
            firebase.firestore().collection('users').doc(userId).get()
            .then((doc) => {
                if (doc.exists) {
                    const data = doc.data().gameData;
                    currentScore = data.score || 0;
                    document.getElementById('score').textContent = currentScore;
                    console.log("Game data loaded:", data);
                }
            })
            .catch((error) => {
                console.log("No saved game data or error:", error);
            });
        }
    </script>
</body>
</html>
