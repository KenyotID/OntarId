<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ratn9Headsome</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root{
  --cell-size:18px;
  --cols:20;
  --rows:14;
  --bg:#1a1a2e;
  --snake:#00ffa1;
  --accent:#ffd60a;
  --panel:#0b3b5e;
}

html,body{
  height:100%;
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background: var(--bg);
  display:flex;
  align-items:center;
  justify-content:center;
}

.wrap{
  width: calc(var(--cols) * var(--cell-size) + 2rem);
  max-width: 98vw;
  background: linear-gradient(145deg,#16162a,#2a2a4d);
  border-radius:15px;
  box-shadow:0 10px 30px rgba(0,0,0,0.5);
  padding:16px;
  position: relative;
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}

.title{
  font-family: 'Press Start 2P', monospace;
  font-size:18px;
  color: var(--accent);
  text-shadow: 0 0 6px rgba(0,0,0,0.7);
  margin-bottom:4px;
}

.info{
  color:#fff;
  font-size:14px;
  padding:4px 8px;
  background: rgba(0,0,0,0.3);
  border-radius:6px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.5);
}

.small{font-size:12px;color:#ccc;}

.board{
  background: #222;
  width: calc(var(--cols) * var(--cell-size));
  height: calc(var(--rows) * var(--cell-size));
  display:grid;
  grid-template-columns: repeat(var(--cols), 1fr);
  grid-template-rows: repeat(var(--rows), 1fr);
  gap:1px;
  border-radius:10px;
  overflow:hidden;
  margin:0 auto;
  position: relative;
}

.cell{
  width:100%;
  height:100%;
  background: #111;
  transition: background 0.2s;
  box-sizing:border-box;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
}

.snake{
  background: var(--snake);
  border-radius:4px;
  box-shadow: 0 0 4px var(--snake);
}

.head{
  background: var(--accent);
  box-shadow: 0 0 6px var(--accent);
}

.food{
  animation: pulse 0.6s infinite alternate;
  font-size:20px;
  color:#ffd60a;
  text-shadow: 0 0 6px #ffd60a, 0 0 12px #ffd60a;
}

@keyframes pulse{
  0%{transform: scale(1);}
  50%{transform: scale(1.3);}
  100%{transform: scale(1);}
}

.controls{
  display:flex;
  gap:12px;
  justify-content:center;
  margin-top:14px;
  flex-wrap:wrap;
}

.btn{
  background: linear-gradient(145deg,#444,#555);
  border:none;
  padding:10px 16px;
  border-radius:8px;
  color:#fff;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 4px 8px rgba(0,0,0,0.4);
  transition: transform 0.1s;
}

.btn:active{
  transform: scale(0.95);
}

.arrow-pad{
  display:grid;
  grid-template-columns:repeat(3,60px);
  gap:10px;
  align-items:center;
  justify-items:center;
}

.arrow{
  width:60px;
  height:60px;
  font-size:26px;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  background: linear-gradient(145deg,#555,#666);
  color:#fff;
  font-weight:700;
  user-select:none;
  box-shadow:0 3px 6px rgba(0,0,0,0.5);
}

.arrow:active{
  transform: scale(0.95);
}

.gameover-overlay{
  position:absolute;
  top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,0.8);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  color:#ff0000;
  font-family: 'Press Start 2P', monospace;
  font-size:16px;
  text-align:center;
  z-index:10;
  display:none;
}

.gameover-overlay button{
  margin-top:12px;
  padding:10px 20px;
  font-family: 'Press Start 2P', monospace;
  font-size:12px;
  background:#ff0000;
  color:#fff;
  border:none;
  border-radius:6px;
  cursor:pointer;
  box-shadow:0 3px 6px rgba(0,0,0,0.5);
}

@media (max-width:420px){
  :root{--cell-size:16px; --cols:18; --rows:12;}
  .arrow{width:50px;height:50px;font-size:22px;}
  .arrow-pad{grid-template-columns:repeat(3,50px);}
}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div>
      <div class="title">Ratno Fineshyt Game</div>
      <div class="small">Kontrol: swipe / tombol arah / keyboard</div>
    </div>
    <div class="hud">
      <div class="info">Score: <span id="score">0</span></div>
      <button id="restart" class="btn">Restart</button>
    </div>
  </div>

  <div id="board" class="board" tabindex="0">
    <div class="gameover-overlay" id="gameover">
      Goblok Main<br>
      Ginian Aja Mati ðŸ’€
      <button id="goRestart">RESTART</button>
    </div>
  </div>

  <div class="controls">
    <div style="min-width:160px">
      <div style="font-size:12px;margin-bottom:6px;color:#ccc">Tombol Sentuh</div>
      <div class="arrow-pad" id="touchPad">
        <div></div>
        <div class="arrow" data-dir="up">â–²</div>
        <div></div>
        <div class="arrow" data-dir="left">â—€</div>
        <div class="arrow" data-dir="down">â–¼</div>
        <div class="arrow" data-dir="right">â–¶</div>
      </div>
    </div>

    <div style="display:flex;flex-direction:column;gap:8px;justify-content:center">
      <button id="speedDown" class="btn">- Speed</button>
      <button id="speedUp" class="btn">+ Speed</button>
    </div>
  </div>

  <!-- Musik -->
  <div style="text-align:center; margin-top:10px;">
    <button id="openMusic" class="btn">Pengaturan Musik</button>
  </div>
  <div id="musicPanel" style="display:none; text-align:center; margin-top:12px;">
    <div style="margin-bottom:8px; color:#ccc; font-size:14px;">Pengaturan Musik</div>
    <button id="musicOn" class="btn">Nyalakan Musik</button>
    <button id="musicOff" class="btn">Matikan Musik</button>
    <button id="musicBack" class="btn">Back</button>
  </div>
</div>

<script>
(function(){
  const BOARD = document.getElementById('board');
  const SCORE = document.getElementById('score');
  const RESTART = document.getElementById('restart');
  const GO_RESTART = document.getElementById('goRestart');
  const GAMEOVER = document.getElementById('gameover');
  const speedUpBtn = document.getElementById('speedUp');
  const speedDownBtn = document.getElementById('speedDown');

  let cols = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cols')) || 20;
  let rows = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--rows')) || 14;
  let cells = [];
  let gridSize = cols*rows;

  function buildBoard(){
    BOARD.innerHTML='';
    BOARD.appendChild(GAMEOVER);
    cells=[];
    for(let i=0;i<gridSize;i++){
      const d=document.createElement('div');
      d.className='cell';
      BOARD.appendChild(d);
      cells.push(d);
    }
  }

  buildBoard();

  function idx(x,y){return y*cols+x;}
  function coord(i){return {x:i%cols,y:Math.floor(i/cols)};}
  function inside(x,y){return x>=0&&y>=0&&x<cols&&y<rows;}

  let snake=[idx(Math.floor(cols/2),Math.floor(rows/2))];
  let dir={x:1,y:0};
  let nextDir={...dir};
  let food=null;
  let running=false;
  let score=0;
  let speed=120;
  let ticker=null;

  function placeFood(){
    let empty=[];
    for(let i=0;i<gridSize;i++) if(!snake.includes(i)) empty.push(i);
    if(empty.length===0) return null;
    food=empty[Math.floor(Math.random()*empty.length)];
  }

  function render(){
    cells.forEach(c=>{c.className='cell';c.textContent='';});
    for(let i=0;i<snake.length;i++){
      let cl='snake';
      if(i===snake.length-1) cl+=' head';
      cells[snake[i]].className='cell '+cl;
    }
    if(food!==null){
      cells[food].className='cell food';
      cells[food].textContent='ðŸ†';
    }
    SCORE.textContent=score;
  }

  function step(){
    if(nextDir.x!==-dir.x||nextDir.y!==-dir.y) dir={...nextDir};
    const head=coord(snake[snake.length-1]);
    const nx=head.x+dir.x;
    const ny=head.y+dir.y;
    if(!inside(nx,ny)){ gameOver(); return;}
    const ni=idx(nx,ny);
    if(snake.includes(ni)){gameOver(); return;}
    snake.push(ni);
    if(ni===food){
      score+=10;
      placeFood();
    } else snake.shift();
    render();
  }

  function gameOver(){
    running=false;
    clearInterval(ticker);
    GAMEOVER.style.display='flex';
    music.pause();
    music.currentTime=0;
  }

  function start(){
    cols=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cols'))||cols;
    rows=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--rows'))||rows;
    gridSize=cols*rows;
    buildBoard();
    snake=[idx(Math.floor(cols/2),Math.floor(rows/2))];
    dir={x:1,y:0};
    nextDir={...dir};
    score=0;
    placeFood();
    render();
    running=true;
    GAMEOVER.style.display='none';
    clearInterval(ticker);
    ticker=setInterval(step,speed);
    // Otomatis play musik jika user sudah klik sebelumnya
    if(userClickedMusic) music.play();
  }

  document.addEventListener('keydown',e=>{
    const key=e.key;
    if(key==='ArrowUp'||key==='w') nextDir={x:0,y:-1};
    if(key==='ArrowDown'||key==='s') nextDir={x:0,y:1};
    if(key==='ArrowLeft'||key==='a') nextDir={x:-1,y:0};
    if(key==='ArrowRight'||key==='d') nextDir={x:1,y:0};
  });

  document.querySelectorAll('.arrow').forEach(b=>{
    b.addEventListener('touchstart',e=>{
      const d=b.getAttribute('data-dir');
      if(d==='up') nextDir={x:0,y:-1};
      if(d==='down') nextDir={x:0,y:1};
      if(d==='left') nextDir={x:-1,y:0};
      if(d==='right') nextDir={x:1,y:0};
      e.preventDefault();
    });
    b.addEventListener('mousedown',e=>{
      const d=b.getAttribute('data-dir');
      if(d==='up') nextDir={x:0,y:-1};
      if(d==='down') nextDir={x:0,y:1};
      if(d==='left') nextDir={x:-1,y:0};
      if(d==='right') nextDir={x:1,y:0};
    });
  });

  (function addSwipe(el){
    let startX=0,startY=0,active=false;
    el.addEventListener('touchstart',e=>{active=true; startX=e.touches[0].clientX; startY=e.touches[0].clientY;},{passive:true});
    el.addEventListener('touchmove',e=>{if(!active) return; e.preventDefault();},{passive:false});
    el.addEventListener('touchend',e=>{
      if(!active) return;
      active=false;
      const endX=e.changedTouches[0].clientX;
      const endY=e.changedTouches[0].clientY;
      const dx=endX-startX,dy=endY-startY;
      if(Math.abs(dx)>Math.abs(dy)){
        if(dx>20) nextDir={x:1,y:0};
        else if(dx<-20) nextDir={x:-1,y:0};
      }else{
        if(dy>20) nextDir={x:0,y:1};
        else if(dy<-20) nextDir={x:0,y:-1};
      }
    },{passive:true});
  })(BOARD);

  RESTART.addEventListener('click',()=>start());
  GO_RESTART.addEventListener('click',()=>start());

  speedUpBtn.addEventListener('click',()=>{
    speed=Math.max(40,speed-20);
    if(running){clearInterval(ticker); ticker=setInterval(step,speed);}
  });
  speedDownBtn.addEventListener('click',()=>{
    speed=Math.min(300,speed+20);
    if(running){clearInterval(ticker); ticker=setInterval(step,speed);}
  });

  // Musik
  const music = new Audio('AdhesiveWombat.-.Night.Shade.NO.COPYRIGHT.8-bit.Music.mp3');
  music.loop = true;
  let userClickedMusic = false;

  const musicPanel = document.getElementById('musicPanel');
  const openMusicBtn = document.getElementById('openMusic');
  const musicOnBtn = document.getElementById('musicOn');
  const musicOffBtn = document.getElementById('musicOff');
  const musicBackBtn = document.getElementById('musicBack');

  openMusicBtn.addEventListener('click', ()=>{
    musicPanel.style.display='block';
    openMusicBtn.style.display='none';
  });

  musicBackBtn.addEventListener('click', ()=>{
    musicPanel.style.display='none';
    openMusicBtn.style.display='inline-block';
  });

  musicOnBtn.addEventListener('click', ()=>{
    music.play();
    userClickedMusic = true;
  });

  musicOffBtn.addEventListener('click', ()=>{
    music.pause();
    music.currentTime=0;
    userClickedMusic = false;
  });

  start();
  BOARD.addEventListener('click',()=>BOARD.focus());
})();
</script>
</body>
</html>
