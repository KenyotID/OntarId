<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Snake Multiplayer</title>
<style>
 body{background:#000;color:#ffd700;font-family:Arial;text-align:center;padding:20px;} 
 h1,h2,h3{color:#ffd700;} 
 .card{background:#111;border:2px solid #ffd700;padding:15px;border-radius:12px;margin:10px;} 
 button,input{padding:10px;font-size:18px;margin:5px;border-radius:8px;border:2px solid #ffd700;background:#222;color:#ffd700;} 
 button:active{transform:scale(0.95);} 
 #gameCanvas{background:#111;border:2px solid #ffd700;} 
 .playerBox{background:#222;border:1px solid #ffd700;margin:5px;padding:8px;border-radius:8px;} 
</style>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
<h1>SNAKE MULTIPLAYER - DARK GOLD</h1>

<div id="mainMenu" class="card">
 <h2>MENU</h2>
 <button onclick="openCreate()">CREATE ROOM</button>
 <button onclick="openJoin()">JOIN ROOM</button>
</div>

<div id="menuCreate" class="card" style="display:none;">
 <h2>CREATE ROOM</h2>
 <p>KODE ROOM:</p>
 <h1 id="roomCodeText"></h1>
 <p>SET SKOR MENANG:</p>
 <input id="winScore" type="number" placeholder="contoh: 10">
 <h3>PLAYER LIST:</h3>
 <div id="playerListCreate"></div>
 <button onclick="startGame()">MULAI</button>
</div>

<div id="menuJoin" class="card" style="display:none;">
 <h2>JOIN ROOM</h2>
 <input id="joinInput" placeholder="Kode Room">
 <button onclick="joinRoom()">MASUK</button>
</div>

<div id="lobby" class="card" style="display:none;">
 <h2>LOBBY ROOM</h2>
 <p>Kode Room: <b id="lobbyCode"></b></p>
 <h3>PLAYER LIST:</h3>
 <div id="playerListLobby"></div>
 <p>Menunggu host mulai...</p>
</div>

<canvas id="gameCanvas" width="360" height="360" style="display:none;"></canvas>

<script>
// FIREBASE CONFIG
const firebaseConfig={apiKey:"AIzaSyC3Yw5NIexJddefw-AtutQ1vPhErdfL89s",authDomain:"akun-7b590.firebaseapp.com",databaseURL:"https://akun-7b590-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"akun-7b590",storageBucket:"akun-7b590.firebasestorage.app",messagingSenderId:"65784994154",appId:"1:65784994154:web:f7b9fd921736462985ed13",measurementId:"G-31JW6E46L1"};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let playerId="P"+Math.floor(Math.random()*999999);
let currentRoom="";
let isHost=false;

// MENU OPEN
function openCreate(){
 document.getElementById("mainMenu").style.display="none";
 document.getElementById("menuCreate").style.display="block";
 const code=Math.floor(100000+Math.random()*900000);
 currentRoom=code;
 isHost=true;
 document.getElementById("roomCodeText").innerText=code;
 db.ref("rooms/"+code).set({winScore:10,host:playerId,started:false});
 db.ref("rooms/"+code+"/players/"+playerId).set({x:5,y:5,score:0});
 db.ref("rooms/"+code+"/players").on("value",snap=>{
  let box="";
  for(let id in snap.val()){box+=`<div class='playerBox'>${id}</div>`;}
  document.getElementById("playerListCreate").innerHTML=box;
 });
}

function openJoin(){
 document.getElementById("mainMenu").style.display="none";
 document.getElementById("menuJoin").style.display="block";
}

function joinRoom(){
 let code=document.getElementById("joinInput").value;
 if(!code)return alert("Isi kode!");
 currentRoom=code;
 isHost=false;
 db.ref("rooms/"+code).once("value",snap=>{
  if(!snap.exists())return alert("Room tidak ditemukan!");
  db.ref("rooms/"+code+"/players/"+playerId).set({x:5,y:5,score:0});
  openLobby();
 });
}

function openLobby(){
 document.getElementById("menuJoin").style.display="none";
 document.getElementById("lobby").style.display="block";
 document.getElementById("lobbyCode").innerText=currentRoom;

 db.ref("rooms/"+currentRoom+"/players").on("value",snap=>{
  let box="";
  for(let id in snap.val()){box+=`<div class='playerBox'>${id}</div>`;}
  document.getElementById("playerListLobby").innerHTML=box;
 });

 db.ref("rooms/"+currentRoom+"/started").on("value",snap=>{
  if(snap.val()===true){startGameplay();}
 });
}

function startGame(){
 if(!isHost)return;
 let win=document.getElementById("winScore").value;
 if(!win)win=10;
 db.ref("rooms/"+currentRoom+"/winScore").set(win);
 db.ref("rooms/"+currentRoom+"/started").set(true);
}

// GAMEPLAY SNAKE
let ctx,grid=20,snake=[{x:5,y:5}],food={x:10,y:10},vx=1,vy=0;

function startGameplay(){
 document.getElementById("lobby").style.display="none";
 document.getElementById("menuCreate").style.display="none";
 document.getElementById("gameCanvas").style.display="block";
 const c=document.getElementById("gameCanvas");ctx=c.getContext("2d");

 spawnFood();
 setInterval(gameLoop,120);
 window.addEventListener("keydown",control);
}

function control(e){
 if(e.key==="ArrowUp"&&vy!==1){vx=0;vy=-1;}
 if(e.key==="ArrowDown"&&vy!==-1){vx=0;vy=1;}
 if(e.key==="ArrowLeft"&&vx!==1){vx=-1;vy=0;}
 if(e.key==="ArrowRight"&&vx!==-1){vx=1;vy=0;}
}

function spawnFood(){food.x=Math.floor(Math.random()*18);food.y=Math.floor(Math.random()*18);}

function gameLoop(){
 let head={x:snake[0].x+vx,y:snake[0].y+vy};
 snake.unshift(head);
 if(head.x===food.x&&head.y===food.y){spawnFood();} else snake.pop();

 ctx.fillStyle="#000";ctx.fillRect(0,0,360,360);
 ctx.fillStyle="#ffd700";
 snake.forEach(p=>ctx.fillRect(p.x*grid,p.y*grid,grid-2,grid-2));
 ctx.fillStyle="#fffa50";ctx.fillRect(food.x*grid,food.y*grid,grid-2,grid-2);
}
</script>

</body>
</html>
