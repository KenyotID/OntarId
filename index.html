<!DOCTYPE html>
<html>
<head>
    <title>Multiplayer Game - akun-7b590</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .player { 
            padding: 12px; 
            margin: 8px; 
            background: white; 
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #007cba;
        }
        button { 
            padding: 12px 20px; 
            margin: 5px; 
            font-size: 16px; 
            background: #007cba;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        button:hover {
            background: #005a87;
        }
        #gameArea {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .myPlayer {
            background: #e3f2fd !important;
            border-left: 4px solid #ff6b6b !important;
        }
    </style>
</head>
<body>
    <div id="gameArea">
        <h1>üéÆ Game Multiplayer Real-time</h1>
        <div id="gameInfo"></div>
        
        <h3>üéØ Kontrol Gerak:</h3>
        <button onclick="moveLeft()">‚¨Ö Kiri</button>
        <button onclick="moveRight()">Kanan ‚û°</button>
        <button onclick="moveUp()">‚¨Ü Atas</button>
        <button onclick="moveDown()">‚¨á Bawah</button>
        <br><br>
        <button onclick="changeName()">‚úèÔ∏è Ganti Nama</button>
        <button onclick="addScore()">‚≠ê Tambah Score</button>
    </div>

    <div id="playersList"></div>

    <script>
        // üî• CONFIG FIREBASE KAMU
        const firebaseConfig = {
            apiKey: "AIzaSyC3Yw5NIexJddefw-AtutQ1vPhErdfL89s",
            authDomain: "akun-7b590.firebaseapp.com",
            projectId: "akun-7b590",
            storageBucket: "akun-7b590.firebasestorage.app",
            messagingSenderId: "65784994154",
            appId: "1:65784994154:web:f7b9fd921736462985ed13"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Player data
        const playerId = 'player_' + Math.random().toString(36).substr(2, 9);
        let myPlayer = {
            x: Math.floor(Math.random() * 500),
            y: Math.floor(Math.random() * 300),
            name: 'Player_' + playerId.substr(7, 4),
            color: '#' + Math.floor(Math.random()*16777215).toString(16),
            score: 0,
            lastUpdate: Date.now()
        };

        // Simpan player pertama kali
        db.ref('players/' + playerId).set(myPlayer);
        console.log('Player created:', playerId);

        // Listen untuk perubahan real-time
        db.ref('players').on('value', (snapshot) => {
            const players = snapshot.val();
            console.log('Players update:', players);
            updateDisplay(players);
        });

        // Fungsi gerak
        function moveLeft() { updatePosition(-30, 0); }
        function moveRight() { updatePosition(30, 0); }
        function moveUp() { updatePosition(0, -30); }
        function moveDown() { updatePosition(0, 30); }

        function updatePosition(dx, dy) {
            myPlayer.x += dx;
            myPlayer.y += dy;
            myPlayer.lastUpdate = Date.now();
            db.ref('players/' + playerId).set(myPlayer);
        }

        function addScore() {
            myPlayer.score += 1;
            myPlayer.lastUpdate = Date.now();
            db.ref('players/' + playerId).set(myPlayer);
        }

        function changeName() {
            const newName = prompt('Masukkan nama baru:', myPlayer.name);
            if (newName && newName.trim() !== '') {
                myPlayer.name = newName.trim();
                myPlayer.lastUpdate = Date.now();
                db.ref('players/' + playerId).set(myPlayer);
            }
        }

        // Update tampilan
        function updateDisplay(players) {
            if (!players) {
                document.getElementById('playersList').innerHTML = '<p>No players online</p>';
                return;
            }

            let html = `<h3>üë• Pemain Online: ${Object.keys(players).length}</h3>`;
            
            // Convert to array dan urutkan by score
            const playersArray = Object.entries(players).map(([id, data]) => ({ id, ...data }));
            playersArray.sort((a, b) => b.score - a.score);
            
            playersArray.forEach(player => {
                const isMe = player.id === playerId;
                const playerClass = isMe ? 'player myPlayer' : 'player';
                
                html += `
                    <div class="${playerClass}" style="border-left-color: ${player.color}">
                        <strong>${player.name} ${isMe ? 'üéØ (YOU)' : ''}</strong><br>
                        üéØ Position: ${player.x}, ${player.y}<br>
                        ‚≠ê Score: <strong>${player.score}</strong><br>
                        <small>üÜî ${player.id.substr(0, 10)}...</small>
                    </div>
                `;
            });
            
            document.getElementById('playersList').innerHTML = html;
            
            // Update game info
            document.getElementById('gameInfo').innerHTML = 
                `<div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>üéÆ Player Kamu:</strong> ${myPlayer.name}<br>
                    <strong>üìç Posisi:</strong> ${myPlayer.x}, ${myPlayer.y}<br>
                    <strong>‚≠ê Score:</strong> ${myPlayer.score}<br>
                    <strong>üÜî ID:</strong> ${playerId}
                </div>`;
        }

        // Cleanup ketika tutup tab
        window.addEventListener('beforeunload', () => {
            db.ref('players/' + playerId).remove();
            console.log('Player removed:', playerId);
        });

        // Juga cleanup kalau refresh page
        window.addEventListener('pagehide', () => {
            db.ref('players/' + playerId).remove();
        });

        console.log('Game started! Open this in multiple tabs to test multiplayer.');
    </script>
</body>
</html>
